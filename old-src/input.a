
import lib/devices/input/joystick.a
import lib/devices/input/keyboard.a
import lib/devices/input/mouse.a

Joystick->var console_joystick;
Keyboard->var console_keyboard;
Mouse->var console_mouse;

if (Joystick.count()) {
	console_joystick = new(Joystick).construct(0);
	print "[CONSOLE_OS] Found connected joystick[0] with name \"" ++ console_joystick.name() ++ "\"\n";
}

if (Keyboard.count()) {
	console_keyboard = new(Keyboard).construct(0);
	print "[CONSOLE_OS] Found connected keyboard[0]\n";
}

if (Mouse.count()) {
	console_mouse = new(Mouse).construct(0);
	print "[CONSOLE_OS] Found connected mouse[0]\n";
}

func console_input_button_left_name {
	if (console_joystick) return "le bouton directionnel a gauche";
	if (console_keyboard) return "the left arrow key";
	
	return "<BUTTON_LEFT>";
}

func console_input_button_right_name {
	if (console_joystick) return "le bouton directionnel a droite";
	if (console_keyboard) return "the right arrow key";
	
	return "<BUTTON_RIGHT>";
}

func console_input_button_up_name {
	if (console_joystick) return "le bouton directionnel du haut";
	if (console_keyboard) return "the upper arrow key";
	if (console_mouse   ) return "the right mouse button";
	
	return "<BUTTON_UP>";
}

func console_input_button_down_name {
	if (console_joystick) return "le bouton directionnel du bas";
	if (console_keyboard) return "the bottom arrow key";
	if (console_mouse   ) return "the left mouse button";
	
	return "<BUTTON_DOWN>";
}

//~ func console_input_button_left_name {
	//~ if (console_joystick) return "the left D-PAD button";
	//~ if (console_keyboard) return "the left arrow key";
	
	//~ return "<BUTTON_LEFT>";
//~ }

//~ func console_input_button_right_name {
	//~ if (console_joystick) return "the right D-PAD button";
	//~ if (console_keyboard) return "the right arrow key";
	
	//~ return "<BUTTON_RIGHT>";
//~ }

//~ func console_input_button_up_name {
	//~ if (console_joystick) return "the upper D-PAD button";
	//~ if (console_keyboard) return "the upper arrow key";
	//~ if (console_mouse   ) return "the right mouse button";
	
	//~ return "<BUTTON_UP>";
//~ }

//~ func console_input_button_down_name {
	//~ if (console_joystick) return "the bottom D-PAD button";
	//~ if (console_keyboard) return "the bottom arrow key";
	//~ if (console_mouse   ) return "the left mouse button";
	
	//~ return "<BUTTON_DOWN>";
//~ }

var console_pressing_left;
var console_pressing_right;
var console_pressing_up;
var console_pressing_down;

func console_input_button_left {
	var result = 0;
	if (console_joystick) result = result + (console_joystick.axis(4) < -0.5);
	if (console_keyboard) result = result + console_keyboard.scancode(0x050);
	
	var was_pressing = console_pressing_left;
	console_pressing_left = result;
	return not was_pressing and result;
}

func console_input_button_right {
	var result = 0;
	if (console_joystick) result = result + (console_joystick.axis(4) > 0.5);;
	if (console_keyboard) result = result + console_keyboard.scancode(0x04F);
	
	var was_pressing = console_pressing_right;
	console_pressing_right = result;
	return not was_pressing and result;
}

func console_input_button_up {
	var result = 0;
	if (console_joystick) result = result + (console_joystick.axis(5) < -0.5);
	if (console_keyboard) result = result + console_keyboard.scancode(0x052);
	if (console_mouse   ) result = result + console_mouse.button(Mouse.BUTTON_RIGHT);
	
	var was_pressing = console_pressing_up;
	console_pressing_up = result;
	return not was_pressing and result;
}

func console_input_button_down {
	var result = 0;
	if (console_joystick) result = result + (console_joystick.axis(5) > 0.5);
	if (console_keyboard) result = result + console_keyboard.scancode(0x051);
	if (console_mouse   ) result = result + console_mouse.button(Mouse.BUTTON_LEFT);
	
	var was_pressing = console_pressing_down;
	console_pressing_down = result;
	return not was_pressing and result;
}
